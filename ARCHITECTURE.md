# Архитектура проекта

## Структура файлов

```
testVer2/
├── logic.py          # Игровая логика (ядро)
├── game_gui.py       # Графический интерфейс (Pygame)
├── config.py         # Настройки и конфигурация
├── examples.py       # Интерактивные примеры
├── main.py           # (существующий файл)
├── requirements.txt  # Зависимости Python
├── Dockerfile        # Контейнеризация
├── README.md         # Основная документация
├── QUICKSTART.md     # Быстрый старт
├── INSTALL.md        # Инструкции по установке
└── ARCHITECTURE.md   # Этот файл

```

## Модули

### 1. `logic.py` - Игровая логика

**Основной модуль**, содержащий всю бизнес-логику игры без привязки к конкретному фреймворку визуализации.

#### Классы:

##### `Color`
- Представление цвета в RGB
- Методы: `to_tuple()`, `to_hex()`, `from_tuple()`
- Используется для всех цветовых операций

##### `Ball`
- Представление шарика
- Свойства: позиция (x, y), скорость (vx, vy), радиус, цвет, ID
- Методы:
  - `move(dt)` - движение
  - `distance_to(other)` - расстояние до другого шарика
  - `is_touching(other)` - проверка касания
  - `is_point_inside(px, py)` - точка внутри шарика
  - `copy()` - создание копии

##### `ColorMixer`
- Смешивание цветов шариков
- Использует HSV цветовое пространство для естественного смешивания
- Методы:
  - `mix_colors(color1, color2)` - смешивание двух цветов
  - `_rgb_to_hsv(color)` - конвертация RGB → HSV
  - `_hsv_to_rgb(h, s, v)` - конвертация HSV → RGB

##### `DeleteZone`
- Зона на экране для удаления шариков
- Методы:
  - `contains_point(px, py)` - точка в зоне
  - `contains_ball(ball)` - шарик в зоне

##### `Inventory`
- Система хранения шариков
- Методы:
  - `add_ball(ball)` - добавить шарик
  - `remove_ball(ball)` - удалить шарик
  - `pop_ball()` - извлечь последний шарик
  - `is_full()` / `is_empty()` - проверки состояния

##### `GameLogic`
- Основной класс управления игрой
- Методы:
  - `update(dt)` - обновление состояния игры
  - `add_ball(ball)` / `remove_ball(ball)` - управление шариками
  - `create_random_ball()` - создание случайного шарика
  - `suck_ball_at_position(x, y)` - всасывание шарика
  - `spit_ball_at_position(x, y, vx, vy)` - выплевывание шарика
  - `_handle_boundary_collision(ball)` - отскок от границ
  - `_handle_ball_collisions()` - столкновения и смешивание

#### Функции:

- `create_predefined_colors()` - создает палитру из 10 предустановленных цветов

---

### 2. `game_gui.py` - Графический интерфейс

**Визуализация** игровой логики с помощью Pygame.

#### Класс `GameGUI`:

##### Инициализация:
- Создание окна Pygame
- Инициализация `GameLogic`
- Настройка зоны удаления
- Создание начальных шариков

##### Основной цикл (`run()`):
- Обработка событий (мышь, клавиатура)
- Обновление логики
- Отрисовка всех элементов
- Контроль FPS

##### Отрисовка:
- `_draw()` - главный метод отрисовки
- `_draw_balls()` - рисует шарики с бликами и обводкой
- `_draw_delete_zone()` - зона удаления
- `_draw_inventory()` - панель инвентаря
- `_draw_suck_radius()` - радиус всасывания при зажатой ЛКМ
- `_draw_info()` - информация (FPS, количество шариков)
- `_draw_help()` - справка по управлению

##### Управление:
- **ЛКМ** - всасывание шариков
- **ПКМ** - выплевывание шариков
- **SPACE** - добавить шарик
- **C** - очистить поле
- **H** - показать/скрыть справку
- **ESC** - выход

---

### 3. `config.py` - Конфигурация

Центральное место для всех настроек игры:

- **Параметры окна**: размер, FPS, заголовок
- **Параметры игры**: количество шариков, их размеры, скорости
- **Инвентарь**: размер, количество слотов
- **Зона удаления**: размер, позиция
- **Физика**: радиус всасывания, множители скорости
- **Цвета интерфейса**: фон, зоны, текст
- **Визуальные эффекты**: обводки, блики, затемнение
- **Шрифты**: название, размеры
- **Цветовая палитра**: предустановленные цвета шариков

---

### 4. `examples.py` - Демонстрационные примеры

Интерактивные примеры использования игровой логики:

1. **Базовая игра** - создание и движение шариков
2. **Смешивание цветов** - таблица смешивания
3. **Система инвентаря** - добавление/извлечение шариков
4. **Столкновение** - демонстрация смешивания при касании
5. **Зона удаления** - автоматическое удаление
6. **Всасывание/выплевывание** - взаимодействие с инвентарем

---

## Поток данных

```
Пользователь
    ↓
[Pygame Events] → game_gui.py
    ↓
[Команды] → GameLogic (logic.py)
    ↓
[Обновление состояния] → Balls, Inventory, DeleteZone
    ↓
[Рендеринг] ← game_gui.py
    ↓
Экран
```

---

## Принципы проектирования

### 1. Разделение ответственности
- **logic.py** - чистая логика, независимая от GUI
- **game_gui.py** - только визуализация и ввод
- **config.py** - все настройки в одном месте

### 2. Модульность
- Каждый класс решает одну задачу
- Классы легко тестируются независимо
- Можно заменить GUI без изменения логики

### 3. Расширяемость
- Легко добавить новые типы шариков
- Можно создать другой GUI (не Pygame)
- Настройки вынесены в config.py

### 4. Читаемость
- Понятные имена классов и методов
- Документация в docstrings
- Примеры использования

---

## Зависимости

```
game_gui.py
    ├── logic.py
    ├── config.py (опционально)
    └── pygame

examples.py
    └── logic.py

logic.py
    ├── math
    ├── random
    ├── typing
    └── dataclasses
```

---

## Расширение проекта

### Добавление новых возможностей:

1. **Новые типы шариков**: Расширьте класс `Ball`
2. **Бонусы**: Создайте класс `Bonus` в `logic.py`
3. **Уровни**: Добавьте класс `Level` для управления уровнями
4. **Звук**: Интегрируйте pygame.mixer в `game_gui.py`
5. **Сохранения**: Добавьте методы сериализации в `GameLogic`
6. **Мультиплеер**: Создайте `network.py` для сетевого взаимодействия

### Альтернативные интерфейсы:

- **Терминал**: ASCII-арт визуализация (ncurses)
- **Web**: JavaScript + Canvas (экспорт логики в JS)
- **3D**: Pygame + PyOpenGL или Panda3D
- **Mobile**: Kivy или Pygame для Android

---

## Производительность

### Оптимизации в текущей версии:

1. **Spatial hashing** - можно добавить для больших количеств шариков
2. **Quad-tree** - для эффективного поиска столкновений
3. **Object pooling** - переиспользование объектов Ball
4. **Batch rendering** - группировка отрисовки в Pygame

### Текущие ограничения:

- Оптимально для ~50 шариков при 60 FPS
- O(n²) проверка столкновений (можно улучшить)
- Синхронная отрисовка (можно распараллелить)

---

## Тестирование

### Ручное тестирование:

```bash
python3 examples.py  # Интерактивные примеры
python3 logic.py     # Демонстрация логики
python3 game_gui.py  # Полная игра
```

### Юнит-тесты (рекомендуется добавить):

```python
# tests/test_logic.py
import unittest
from logic import Color, Ball, ColorMixer

class TestColorMixing(unittest.TestCase):
    def test_red_blue_mix(self):
        mixer = ColorMixer()
        red = Color(255, 0, 0)
        blue = Color(0, 0, 255)
        result = mixer.mix_colors(red, blue)
        # Проверяем, что получился фиолетовый оттенок
        self.assertGreater(result.r, 100)
        self.assertGreater(result.b, 100)
```

---

## Контрибуция

При добавлении новых функций:

1. Добавьте логику в `logic.py`
2. Добавьте визуализацию в `game_gui.py`
3. Добавьте настройки в `config.py`
4. Создайте пример в `examples.py`
5. Обновите документацию

---

Документ актуален на: 27.10.2025

